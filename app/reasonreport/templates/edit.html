{% extends "base.html" %}

{% block content %}
    <div>
        <iframe src="https://rr.alkemata.com/jupyterlite/" class="iframe-container" id="jupyterlite-iframe" allow="encrypted-media" sandbox="allow-same-origin allow-scripts" frameborder="0"   width="100%" height="500px"></iframe>
    </div> 

    <script>
          const documentId = "{{ notebook_id }}";       
  
          function replaceCreateButtonWithPublish() {
            const createButton = document.getElementById('create-button');
            if (createButton) {
                // Remove the "Create Notebook" button
                createButton.style.display = 'none';

                // Create the "Publish" button
                const publishButton = document.createElement('button');
                publishButton.id = 'publish-button';
                publishButton.innerText = 'Publish';
                publishButton.style.display = 'inline-block';

                // Add click event listener to the publish button
                publishButton.addEventListener('click', () => {
                    // Send a message to the iframe when the "Publish" button is clicked
                    const iframe = document.querySelector('iframe'); // Assuming the iframe is on the page
                    if (iframe) {
                        iframe.contentWindow.postMessage('publishNotebook', window.location.origin);
                    }
                });

                // Append the "Publish" button to the auth-buttons div
                document.getElementById('auth-buttons').appendChild(publishButton);
            }
        }          

        const iframe = document.getElementById('jupyterlite-iframe');
        console.log('parent: waiting for readiness')
        // Ensure the iframe is loaded before sending the message
        iframe.onload = async function () {
            window.addEventListener('message', function(event) {
                console.log('parent window: message received - send data', event)
                // Use postMessage to send data to the iframe
                iframe.contentWindow.postMessage({  documentId: documentId });

            }
            )
        
        };

    </script>
{% endblock %}